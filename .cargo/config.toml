# ==============================================
# ESP32-S3 Xtensa 编译配置 - 最激进性能优化
# ==============================================

[build]
target = "xtensa-esp32s3-none-elf"

[target.xtensa-esp32s3-none-elf]
runner = "espflash flash --monitor"

rustflags = [
    # ===== 链接脚本 =====
    "-C", "link-arg=-Tlinkall.x",
    
    # ===== 链接优化 =====
    # 垃圾回收未使用段
    "-C", "link-arg=-Wl,--gc-sections",
    
    # 链接器优化级别
    "-C", "link-arg=-Wl,-O3",
    
    # ===== 代码生成优化 =====
    # 更激进的内联阈值
    "-C", "inline-threshold=275",
    
    # 禁用红区 (嵌入式必须)
    "-C", "no-redzone=yes",
]

# ===== 环境变量 =====
[env]
# defmt 日志级别 - Release 时禁用
DEFMT_LOG = { value = "off", force = true }

# ESP 日志级别
ESP_LOG = "warn"

# ===== 不稳定特性 =====
[unstable]
# 启用 build-std 优化标准库
build-std = ["core", "alloc"]

# ===== 别名命令 =====
[alias]
# 快速构建并烧录
br = "build --release"
fr = "espflash flash --release --monitor"

# 开发模式构建
bd = "build --features dev"
fd = "espflash flash --features dev --monitor"

# 构建示例
eb = "build --example"
ef = "espflash flash --example"
